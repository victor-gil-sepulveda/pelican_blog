<!DOCTYPE html>
<html lang="en">

<head>
		<title>The lost library of Agraphur &mdash; Downloading music from Youtube</title>
		<meta charset="utf-8" />
		
		<!-- Fonts from google fonts -->
		<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>
		<link rel='stylesheet' id='oswald-css' href='http://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
		
		<!-- Twitter stuff -->
		<script src="https://platform.twitter.com/widgets.js"></script>

        <!-- JQuery stuff -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://cdn.rawgit.com/leafo/sticky-kit/v1.1.2/jquery.sticky-kit.js"></script>

		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="https://victor-gil-sepulveda.github.io/theme/css/style.css" />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/atom+xml"
			title="The lost library of Agraphur — Flux Atom"
			href="https://victor-gil-sepulveda.github.io/" /> 
		<!--[if lte IE 8]><script src="https://victor-gil-sepulveda.github.io/theme/js/html5shiv.js"></script><![endif]-->

        <script>
            $(document).ready(function(){
                console.log("Sticking");
                var FRONT_Z_INDEX = 9999;
                $("#menu").stick_in_parent();
                // We make the changes here so the can be undone easily
                // by only detaching the function
                $("#menu").css("z-index", FRONT_Z_INDEX);
                $("#menu").css("background-color",  $(document.body).css("background-color"));
            });
        </script>

</head>

<body class="home blog custom-background " >
	<div id="container">
		<div id="header">
				<h1 id="site-title"><a href="https://victor-gil-sepulveda.github.io">The lost library of Agraphur</a></h1>
<h2 id="site-description">Pieces from a whole</h2>		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container" >
				<ul id="menu-navigation" class="menu">
					<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
					<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/tags.html">Tags</a></li>
					<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/repositories_static.html">Repos</a></li>
					<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/cv.html">My CV</a></li>


					<li class="menu-item-type-post_type menu-item-object-page" style="margin: 0px; padding: 0px; padding-left: 10px;float: right;width: 30px;"><a href="feeds/all.atom.xml" style="margin: 0px; padding: 0px" target="_blank"><img src='https://victor-gil-sepulveda.github.io/theme/images/feed.png' alt='Feed' style = 'margin:0px; padding:0px;'></a></li>
					<li class="menu-item-type-post_type menu-item-object-page" style="margin: 0px; padding: 0px; padding-left: 10px;float: right;width: 30px;"><a href="mailto:victor.gil.sepulveda@gmail.com" style="margin: 0px; padding: 0px" target="_blank"><img src='https://victor-gil-sepulveda.github.io/theme/images/contact.png' alt='Contact' style = 'margin:0px; padding:0px;'></a></li>
					<li class="menu-item-type-post_type menu-item-object-page" style="margin: 0px; padding: 0px; padding-left: 10px;float: right;width: 30px;"><a href="https://twitter.com/intent/follow?screen_name=vgilsep" style="margin: 0px; padding: 0px" target="_blank"><img src='https://victor-gil-sepulveda.github.io/theme/images/twitter.png' alt='Twitter' style = 'margin:0px; padding:0px;'></a></li>
					<li class="menu-item-type-post_type menu-item-object-page" style="margin: 0px; padding: 0px; padding-left: 10px;float: right;width: 30px;"><a href="https://es.linkedin.com/in/víctor-a-gil-4509b0115" style="margin: 0px; padding: 0px" target="_blank"><img src='https://victor-gil-sepulveda.github.io/theme/images/linked-in.png' alt='LinkedIn' style = 'margin:0px; padding:0px;'></a></li>
					<li class="menu-item-type-post_type menu-item-object-page" style="margin: 0px; padding: 0px; padding-left: 10px;float: right;width: 30px;"><a href="https://plus.google.com/u/0/110041683601844851417" style="margin: 0px; padding: 0px" target="_blank"><img src='https://victor-gil-sepulveda.github.io/theme/images/google-plus.png' alt='Google+' style = 'margin:0px; padding:0px;'></a></li>
				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
		</div>
	
		<div > <!--id="contents"-->


<div id= "contents">
    <div class="post type-post status-publish format-standard hentry category-general" id="post">
	    <div class="entry-meta">
		    <div class="date"><a href="https://victor-gil-sepulveda.github.io/downloading-music-from-youtube.html">Thu 15 December 2016</a></div>
		    <span class="byline">By <a href="https://victor-gil-sepulveda.github.io/author/victor-a-gil.html">Víctor A. Gil</a></span>
			    <div class="comments"><a href="https://victor-gil-sepulveda.github.io/downloading-music-from-youtube.html#disqus_thread" title="Comment on Downloading music from Youtube">comments</a></div>
			    <span class="cat-links"><a href="https://victor-gil-sepulveda.github.io/category/posts.html" title="View all posts in posts" rel="category tag">posts</a></span>
	    </div> <!-- /#entry-meta -->
	    <div class="main">
		    <h2 class="entry-title">
			    <a href="https://victor-gil-sepulveda.github.io/downloading-music-from-youtube.html" title="Permalink to Downloading music from Youtube" rel="bookmark">Downloading music from Youtube</a>
		    </h2>
		    <div class="entry-content">
			    <p>If you like music and Youtube is your main source, I am pretty sure that, at some point, you wanted to save some of the songs to disk. It is not impossible, indeed there are a million tools out there targeting this same problem. My personal choice has always been <a class="reference external" href="http://jdownloader.org/">JDownloader</a>, but I must say this is not the best software you can find: it is heavy and it is very obscure.</p>

<p>The last time I had to reinstall my OS (that is, two weeks ago) I decided to look for something lighter than JDownloader. After a not-so-long search I found <a class="reference external" href="http://rg3.github.io/youtube-dl/">youtube-dl</a>, a very powerful command line video downloader for Youtube.</p>

<p>youtube-dl is great. It is really easy to use, and it works like a charm, but it downloads videos, not sound files. This means a bit of postprocessing is needed. Thanks to God I found an incredibly handy <a class="reference external" href="http://www.linuxjournal.com/content/grabbing-your-music-youtube-do-it-your-way">post from Emre Sevinc in Linux Journal</a>. There, he explains how to postprocess the downloaded video using ffmpeg and lame, and also offers a bash script to automate the job (which I will not reproduce here, just go to the original article and C-c C-p !!). The script however has some flaws that may be caused by its age (the original post is from 2011!):</p>
<blockquote>
<ul class="simple">
<li>It expects youtube-dl to download only <em>flv</em> files, which is not true anymore.</li>
<li>The two-step conversion using ffmpeg and lame could have been handled in a more elegant way with a one-liner like <code>ffmpeg -i [input] -vn -c:a libmp3lame [ouput].mp3</code>. However, this is a matter of taste.</li>
<li>It does not make the most of the newest flags youtube-dl has. And this one is crucial.</li>
</ul>
</blockquote>
<div class="section" id="a-new-script-using-python">
<h2>A new script using Python</h2>
<p>I must admit that my first impulse was to &quot;fix&quot; the bash script, but then I thought that maybe writing something similar would be quite easy in Python. And I did it. My final goal was to have something able to download the videos using a batch url file, and rename them if a new name was provided. The type of batch file I wanted to use was:</p>
<pre class="code bash literal-block">
url1 rename to this
url2 rename to that
url3
url4 rename again
...
</pre>
<p>The code can be download from in my Github repo (<a class="reference external" href="https://github.com/victor-gil-sepulveda/YoutubeMusicDownloader">here</a>).</p>
</div>
<div class="section" id="youtube-dl-new-command-line-options">
<h2>Youtube-dl new command line options</h2>
<p>As I already said youtube-dl comes with a lot of new functionalities. For instance, it is possible to ask only for the audio tracks and convert them, with something like this:</p>
<pre class="code bash literal-block">
&gt; youtube-dl <span class="o">[</span>url<span class="o">]</span> -x --audio-format mp3 --audio-quality 0
</pre>
<p>That means: Download the music (-x) from [url], and convert it to mp3 (--audio-format mp3) with maximum possible quality (--audio-quality 0).</p>
<p>So, this does exactly what Emre Sevinc's bash script was doing, converting it automatically in a redundant piece of software.</p>
<p>Also, it is possible to use a batch file to provide urls. This batch file has the form:</p>
<pre class="code bash literal-block">
url1
url2
...
urln
</pre>
<p>And with a line like this one:</p>
<pre class="code bash literal-block">
&gt; youtube-dl -a <span class="o">[</span>batch file<span class="o">]</span> -x --audio-format mp3 --audio-quality 0
</pre>
<p>youtube-dl will download the music of all urls. This does exactly the same than my script (except for the renaming). Even the batch files can be used interchangeably. And this makes my 100 lines script redundant too. Or not?</p>
</div>
<div class="section" id="parallelization">
<h2>Parallelization</h2>
<p>The batch mode of youtube-dl has only one minor problem (imho), it treats each url in a serial fashion. This looks like the kind of problems where task-level parallelization could improve the overall performance a lot. To this end I used <a class="reference external" href="https://github.com/victor-gil-sepulveda/pyScheduler">pyScheduler</a> . The changes were minimum:</p>
<blockquote>
<ul class="simple">
<li>Detect and extract the task to a function</li>
<li>Create a scheduler and add the tasks</li>
</ul>
</blockquote>
<p>The results are pretty good when compared with youtube-dl batch mode. I have tested the script using a batch file of small videos (with a lot of versions of the beautiful &quot;Moon River&quot;) and another one that includes longer videos. Downloading them using youtube-dl's batch mode took an average of around 89s. My parallelized script was faster in all cases when using more than one process. It is worth to mention that pyScheduler uses one process as a master controller, so the &quot;real&quot; number of processes used is always n-1. That is why, when the script detects an n &lt;= 2, it defaults to the serial scheduler, which is more efficient.</p>
<p>The average results for the &quot;small batch&quot; are shown in the plot below (times averaged over 10 runs, except in the last case, where I did only 5 runs).</p>
<img alt="Plot 1" src="https://victor-gil-sepulveda.github.io/images/2016_12_15_downloading-music-from-youtube__small_time.png" style="width: 600px;" />
<p>As you can see, the serial behaviour (for n = 2, n = 1 was omitted) is very similar (speedup around <em>1x</em>). The maximum speedups is obtained with 6 processes (<em>1.8x</em>), but it is obvious that increasing the number of processes above 5 does not throw better results. The performance decreases slightly when using 7 processes, which may be related with the fact that my CPU has only 6 cores (I had to try ^.^u ).  Indeed the most noticeable gain is obtained using only 3 processes (2 worker processes).</p>
<p>[BIG ANALYSIS BEING COOKED!]</p>
</div>
<div class="section" id="final-words">
<h2>Final words</h2>
<p>Youtube-dl is an incredibly complete tool to download audio and videos from Youtube. Its batch mode open the doors to really naughty uses like audio scrapping (for research purposes, of course).</p>
<p>The parallelization of my batch script looks to have had an interesting outcome. A small number of processes can increase the performance almost <em>1.5x</em>, which is not that bad. The script could be improved, of course. Some of these improvements would include to not overlap ffmpeg conversions (it may use more than one core and produce a bottleneck) and improving the load balance. Of course, this would mean to have finer control over youtube-dl, and also to code some more hundred lines of code.</p>
<p>Remember that musicians are not photosynthetic (yet) and they need your money to live. If you like their music, consider contributing with their work by buying original discs and going to their concerts.</p>
<p>But, anyway, the next time you feel the urge of downloading some music from Youtube, just stay apart from all those über-complex contraptions hanging around. Use the command line!</p>
<p>Take care!</p>
</div>

		    </div> <!--/#entry-content-->
        		<span class="tag-links"><strong>Tagged</strong>
 <a href="https://victor-gil-sepulveda.github.io/tag/download.html" rel="tag">download</a>,  <a href="https://victor-gil-sepulveda.github.io/tag/ffmpeg.html" rel="tag">ffmpeg</a>,  <a href="https://victor-gil-sepulveda.github.io/tag/memory.html" rel="tag">memory</a>,  <a href="https://victor-gil-sepulveda.github.io/tag/parallel.html" rel="tag">parallel</a>,  <a href="https://victor-gil-sepulveda.github.io/tag/pyscheduler.html" rel="tag">pyScheduler</a>,  <a href="https://victor-gil-sepulveda.github.io/tag/python.html" rel="tag">Python</a>,  <a href="https://victor-gil-sepulveda.github.io/tag/youtube.html" rel="tag">Youtube</a>        		</span>
	    </div> <!--/#main-->
    </div>  <!--/#post-->
</div>

	<div id="comments" style="width: 850px;">
		<div id="respond">
			<div id="disqus_thread"></div>
	        <script type="text/javascript">
	            var disqus_shortname = 'thelostlibraryofagraphur';
	
	            /* * * DON'T EDIT BELOW THIS LINE * * */
	            (function() {
	                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	            })();
	        </script>
	        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</div><!-- #respond -->					
    </div><!-- #comments -->

		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://getpelican.com">Pelican</a>, theme based on pelican-chunk by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
				<script type="text/javascript">
					var _gaq = _gaq || [];
					_gaq.push(['_setAccount', 'UA-52604711-1']);
					_gaq.push(['_trackPageview']);
					(function() {
						var ga = document.createElement('script'); 
						ga.type = 'text/javascript'; ga.async = true;
						ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
						var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
					})();
				</script>
<script type="text/javascript">
    var disqus_shortname = 'thelostlibraryofagraphur';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>